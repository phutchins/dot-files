function OktaPlugin(){var k=2*1000;var l=this;var b="My Applications";var a=new NullOktaIeWrapper();this.rootBookmark=null;this.chromeConfig=new ChromePluginConfig();var d=new Okta.Config(a);var c=new OktaApiClient(a,d);var h={};var g;var m=["shared/js/common/system.js","shared/js/common/waitFor.js","shared/js/thirdparty/jquery.simulate.js","shared/js/thirdparty/spin.js","shared/js/content/locator.js","shared/js/content/overlay.js","shared/js/engine/script.js"];function f(q,o,s){var p=0;var n=function(){p++;if(p==o.length&&s){s()}};for(var r=0;r<o.length;r++){chrome.tabs.executeScript(q,{file:o[r],allFrames:true},n)}}function i(n){var o=h[n];if(!o){o=new OktaScriptEngine(a,c);h[n]=o}return o}this.onMessageFromContentScript=function(r,q,n){var o=q.tab.id,p=Okta.Util.decodePageData(r.pageData),s=new Okta.Url(p.location);if(d.isOktaHome(s)){g.processHomePageUrl(s,r.cookie);if(this.chromeConfig.syncBookmarksAutomatically()){this.syncBookmarks()}}else{if(d.isOktaPluginInterstitial(s)){Log.info("On the plugin interstitial page");g.setCookies(r.cookie);c.loadSitesIfNotLoaded()}else{if(r.errorMessage){Log.error(o+" error on "+r.url+": "+r.errorMessage);if(r.statusURI){c.post(r.statusURI,{e:true,u:s.href,m:r.errorMessage,v:PLUGIN_VERSIONS.currentVersion})}}}}n({})};function e(o,r,p,s){var q=i(o);Log.skipAudit("contentLoaded for tab {0}: {1}",o,r.href);var n=q.getScript(r,p);if(n&&n==="SITEFLOW_LOADED"){s("siteFlowLoaded")}else{if(n){Log.debug("Sending script to executor");f(o,m,function(){s("runScript",n.getState())})}else{Log.skipAudit("Sending page init: "+r.href);g.pageLoaded(o,r,s)}}}function j(p){var o,n,q;o=c.findAuthSite(new Okta.Url(p.url),false);if(!o||!o.credURI){return}n=a.getGlobalState("basicAuth-"+o.authURL,0);if(p.timeStamp-n<k){return}a.setGlobalState("basicAuth-"+o.authURL,p.timeStamp);q=c.fetchJSON(o.credURI);return q&&{authCredentials:{username:q.u,password:q.p}}}this.init=function(){g=new SharedPlugin(a,c,d);g.init();chrome.tabs.onRemoved.addListener(function(n){h[n.id]=null});Log.info("Loading Okta Secure Web Authentication Plug-in v"+PLUGIN_VERSIONS.currentVersion);chrome.extension.onRequest.addListener(System.hitch(this,"onMessageFromContentScript"));this.bookmarks=new Bookmarks(b,"app-links");chrome.tabs.getSelected(null,function(n){if(d.isOktaHome(new Okta.Url(n.url))){chrome.tabs.executeScript(n.id,{code:"location.reload(true);"})}});chrome.extension.onConnect.addListener(function(n){var o=n.sender.tab.id,p=Okta.Util.decodePageData(n.name),q=new Okta.Url(p.location);var r=function(s,t){n.postMessage({actionType:s,data:t})};e(o,q,p,r);n.onMessage.addListener(function(s){g.onMessageFromContentScript(o,q,s,r,window)})});chrome.webRequest.onAuthRequired.addListener(j,{urls:["<all_urls>"]},["blocking"])};this.syncBookmarks=function(){Log.debug("Synchronizing bookmarks");var n=c.getBookmarks();if(n&&n.bookmark){this.bookmarks.syncBookmarks(n.bookmark,true)}}};