System.expect("Log");System.expect("LocalStorage");function Bookmarks(g,h){var e="bookmark-"+h;var b=false;this.syncBookmarks=function(k,i){if(b){Log.debug("syncBookmarks: Bookmarks are already being synchronized in another thread. Skipping this request.");return}b=true;var j=this;chrome.bookmarks.getChildren(this.rootBookmark.id,function(o){try{var p={};for(var s in o){var r=o[s];if(p[r.title]){p[r.title+"#"+r.id]=r}else{p[r.title]=r}Log.debug("Found existing bookmark "+r.title)}for(var n=0;n<k.length;n++){var q=$okta.trim(k[n].label);var m=k[n].url;if(p[q]){if(p[q].url==m){Log.debug("Bookmark "+q+" already exists ["+p[q].id+"]; up-to-date")}else{Log.debug("Bookmark "+q+" already exists ["+p[q].id+"]; updating");chrome.bookmarks.update(p[q].id,{url:m})}delete p[q]}else{Log.debug("Bookmark "+q+" not found; creating now under "+j.rootBookmark.id);chrome.bookmarks.create({parentId:j.rootBookmark.id,title:q,url:m})}}if(i){for(var l in p){Log.debug("Removing bookmark "+p[l].title);chrome.bookmarks.remove(p[l].id)}}}finally{b=false}})};function f(m,l){if(!l){return null}var j=null;for(var k=0;k<l.length&&!j;k++){if(l[k].title==m){j=l[k]}else{j=f(m,l[k].children)}}return j}function d(i){Log.debug("Searching for "+g);chrome.bookmarks.getTree(function(k){var j=f(g,k);if(j){i.rootBookmark=j;LocalStorage.put(e,i.rootBookmark.id)}else{chrome.bookmarks.create({parentId:"1",title:g},function(l){i.rootBookmark=l;LocalStorage.put(e,i.rootBookmark.id)})}})}var c=this;var a=LocalStorage.get(e);if(a){chrome.bookmarks.get(a,function(i){if(i&&i.length){c.rootBookmark=i[0]}else{d(c)}})}else{d(c)}};