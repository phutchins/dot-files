System.expect("Log");var MAX_RESPONSE_SIZE=10000000;var HttpRequest=function(){var b=function(c){return(c.status>199&&c.status<300)};var a=function(c,g,e){var f=new XMLHttpRequest();if(c.async&&e){f.onreadystatechange=function(){if(f.readyState==4){Log.debug("HttpRequest: async result received from {0}",c.url);e(f)}}}f.open(g,c.url,!!c.async);if(c.headers){for(var d in c.headers){f.setRequestHeader(d,c.headers[d])}}return f};return{fetchJSON:function(c){var d=function(i){var h=null;try{if(i.responseText.length>MAX_RESPONSE_SIZE){throw"Response exceeds max response size"}else{if(i.status==200){h=JSON.parse(i.responseText)}else{if(i.status>399&&c.failure){h=c.failure(i)}}}}catch(j){Log.error("HttpRequest::fetchJSON::handleResponse: {0}",j)}if(c.oncomplete){c.oncomplete(h)}return h};var f=a(c,"GET",d);try{f.send(null);if(!c.async){return d(f)}}catch(g){Log.error("HttpRequest::fetchJSON: {0}",g)}},formPost:function(c){var d=function(j){var i=null;try{if(j.responseText.length>MAX_RESPONSE_SIZE){throw"Response exceeds max response size"}else{if(j>199&&j<300&&c.success){i=j.responseText}else{if(j.status>399&&c.failure){i=c.failure(j)}}}}catch(k){Log.error("HttpRequest::formPost::handleResponse: {0}",k)}if(c.oncomplete){c.oncomplete(i,d)}return i};var f=a(c,"POST");var g=c.data;if(typeof(g)=="function"){g=g()}if(typeof(g)=="object"){Log.debug("Serializing as object");g=this.formSerialize(g)}f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");try{f.send(g);if(!c.async){return d(f)}}catch(h){Log.error("HttpRequest::formPost: {0}",h)}},formSerialize:function(f){var d=[];for(var c in f){var e=f[c];d.push(encodeURIComponent(c)+"="+encodeURIComponent(e))}return d.join("&").replace(/%20/g,"+")}}}();