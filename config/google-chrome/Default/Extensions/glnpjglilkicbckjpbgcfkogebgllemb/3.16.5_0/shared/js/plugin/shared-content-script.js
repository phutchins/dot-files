function SharedContentScript(g,k){var d,j,e,i,l;function m(t){e=t;Log.init(e.settings.outputToConsole,e.audit);ENV._domain=e.oktaDomain;var p=false;try{p=(g==g.top)}catch(r){}if(p){l=e.currentSps;k("monitorSps",null)}if(e.audit){var o=$okta("<div id='okta_plugin_audit_button'/>",g.document);o.appendTo(g.document.body).click(function(){o.text(Log.getAuditString())})}if(e.matchedFullCredSitesNoPw.length>0){var q,s;q=e.matchedFullCredSitesNoPw[0].id;s=new App(q,g,k);if(s.isLoggedIn()){s.attachLogoutHandlers()}if(e.settings.pluginFormFillCaptureEnabled){i=new OktaPluginCssInjector(g.top?g.top:g,k);if(e.showSavePasswordBar){n(e.showSavePasswordBar)}d=new Okta.FormMonitor(g.document);d.on("okta-form-found",f).on("okta-form-disappeared",a).on("okta-register-submit",h)}}}function f(o){if(l&&o.forms[0].isLoginForm()){b(l,o.forms[0])}if(!j||j instanceof AutofillBar||!j.isOpen()){k("foundLoginOrPasswordForm",{ids:_okta(e.matchedFullCredSitesNoPw).map(function(p){return p.id}),changePwForm:o.forms[0].isChangePasswordForm()})}}function a(o){if(j instanceof AutofillBar){j.close();j=null}}function h(o){k("registerSubmit",{formCapture:o.formCapture})}function c(){Log.debug("SharedContentScript::monitorSps");var p=$okta("form#appForm",g.document).first();if(p.length==1){var o=p.find("input").map(function(q,r){return r.name}).get();k("monitorSps",{spsInfo:{fields:o,statusUri:p.data("okta-status")}})}}function b(s,t){Log.debug("SharedContentScript::checkSps");var q=$okta(t.$el).find("input[name],select[name],textarea[name]").map(function(u,v){return v.name}).get();for(var o=0;o<s.fields.length;o++){var r=s.fields[o];if($okta.inArray(r,q)<0){var p="It looks like the SPS app is out of sync with the login form: Could not find '"+r+"' field";Log.error("SharedContentScript::checkSps: {0}",p);if(s.statusUri){k("reportSpsStatus",{oktaUri:s.statusUri,isError:true,url:g.location.href,message:p})}break}}}function n(o){if(g.top==g){j=new SavePasswordBar(g,k);j.create(i,o)}}this.onBackgroundPageMessage=function(q){Log.debug("SharedContentScript::onBackgroundPageMessage: {0} {1}",q.actionType,q.data);var o=q.data;switch(q.actionType){case"init":m(o);break;case"fillCred":var p=d.getFirstForm();if(p){p.fillCreds(o.cred);if(p.isLoginForm()){p.submit()}}break;case"autoSubmit":var p=d.getFirstForm();if(p){p.fillCreds(o.cred);p.submit()}break;case"showBarWithMFA":case"showBarWithLogin":case"showBarWithUsername":if(j&&!(j instanceof AutofillBar)&&j.isOpen()){break}j=new AutofillBar(g,k,i,e.settings);switch(q.actionType){case"showBarWithMFA":j.showBarWithMFA(o.ruleId,o.appUserId);break;case"showBarWithLogin":j.showBarWithLogin(o.appUserId);break;case"showBarWithUsername":j.showBarWithUsername(o.creds,o.changePwForm);break}break;case"showSavePasswordBar":n(o.showSavePasswordBar);break;case"LoginHomePage":if(g.name==="oktaPopupLogin"){g.close()}break;case"EmbedLoginPage":c();break;case"PopupClosed":if(j&&j instanceof AutofillBar&&j.isOpen()){j.close()}if(d){d.scan()}break;case"preloadSpinner":var r=g.document.createElement("img");r.setAttribute("src",ENV.OverlayImage);r.setAttribute("style","display:none");g.document.body.appendChild(r);break;case"pluginEvents":$okta("#pluginEvents",g.document).attr("eventname",o.eventName).click();break}}};