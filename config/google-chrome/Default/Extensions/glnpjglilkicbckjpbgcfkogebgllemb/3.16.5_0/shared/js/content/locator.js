System.expect("Log");function locateElement(h,b,e){try{var a=_getLocator(h);Log.debug("locateElement: "+a.type+"["+a.value+"]");try{if(h.action.frame){var g=_locateFrame(h);var d=_getFrameDocument(g);if(d){Log.debug("Using document from frame: "+d.location.href);h.document=d}else{throw"Could not get content document for frame '"+h.action.frame+"'"}}var f=_getElements(h.document,a);return _prepareResult(f,b)}catch(c){throw a.type+"["+a.value+"]: "+c}}catch(c){_onerror("locateElement: "+c,e)}return null}function locateForm(f,d){try{var a=_getLocator(f);Log.debug("locateForm: "+a.type+"["+a.value+"]");try{var e=locateElement(f,true,true);var b=$okta(e).filter("form");return _prepareResult(b,false)}catch(c){throw a.type+"["+a.value+"]: "+c}}catch(c){_onerror("locateForm: "+c,d)}return null}function _locateFrame(g){var d=g.window.document;var b=g.action.frame;var e=null;Log.debug("Looking for '"+b+"' frame in "+d.location.href);try{var a=_parseLocator(b,"name");switch(a.type){case"css":e=a.value;break;case"id":e="frame#"+a.value+", iframe#"+a.value;break;case"name":e='frame[name="'+a.value+'"], iframe[name="'+a.value+'"]';break;default:throw"Unknown locator type"}Log.debug("CSS selector ["+e+"]");var f=$okta(e,d).filter("frame, iframe");return _prepareResult(f,false)}catch(c){throw"Could not locate frame '"+b+"': "+c}}function _getFrameDocument(b){var a=b.contentWindow||b.contentDocument;if(a.document){a=a.document}return a}function _getLocator(a){if(a.action.element){return _parseLocator(a.action.element,"id")}if(a.action.name=="css"){return{type:"css_legacy",value:a.action.value}}if(a.action.id){return{type:"id_legacy",value:a.action.id}}if(a.action.name){return{type:"name_legacy",value:a.action.name}}throw"No element selector specified"}function _parseLocator(d,c){var b=new RegExp("^([^=]*)=(.*)");var a=b.exec(d);if(a==null){return{type:c,value:d}}else{return{type:a[1],value:a[2]}}}function _getElements(b,a){switch(a.type){case"css":case"css_legacy":return $okta(a.value,b).toArray();case"id":var d=$okta("#"+a.value,b)[0];return d?[d]:[];case"name":var c=b.getElementsByName(a.value);return $okta.makeArray(c);case"id_legacy":case"name_legacy":var d=$okta("#"+a.value,b)[0];if(d){return[d]}var c=b.getElementsByName(a.value);return $okta.makeArray(c);default:throw"Unknown locator type"}}function _prepareResult(b,a){if(b&&b.length){if(a){return b}else{if(b.length==1){return b[0]}else{throw"Multiple matches found, but only one match allowed"}}}throw"No matches found"}function _onerror(b,a){Log.debug(b);if(a){throw b}};