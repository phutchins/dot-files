System.expect("Log");function FormProcessor(){Log.debug("FormProcessor");var a;function b(h,g,f,e){Log.debug("FormProcessor::match");return _okta(f).select(function(i){return(i[g]==(e?h:SHA256(h)))})}function c(e,f){$okta.each(f,function(g,h){e[h.id]=h})}function d(p,h){Log.debug("FormProcessor::processForm: {0}",h);var u={};function q(A){var i=b(A,"username",h,true);Log.debug("processForm::matchUsername: {0}, match: {1}",A,i);c(u,i)}var n={};function x(A){var i=b(A,"password",h,true);Log.debug("processForm::matchPassword: {0}, match: {1}",{password:A},i);c(n,i);return i.length}var g;var z=[];var k=false;var y=0;for(var v=0;v<p.length;v++){var l=p[v];if(l.type=="text"||l.type=="email"||l.type=="textarea"){if(!k){if(l.value.length>0){q(l.value);g=l.value}}}else{if(l.type=="password"){if(l.value.length>0){k=true;y=y+1;if(!x(l.value)){if(z.length==0||z[z.length-1]!=l.value){z.push(l.value)}}}}}}var o;var f;var s;var r;function e(B,A){Log.debug("processForm::matchIfOnlyOne");if(_okta(B).keys().length==1){var i=_okta(B).values()[0];if(A&&!A[i.id]){return}return i}}function w(B,A){var i=[];$okta.each(B,function(C,D){if($okta.inArray(D,A)!=-1){i.push(D)}});return i}var t=w(_okta(n).keys(),_okta(u).keys()).length;var j=false;var m=false;Log.debug("processForm result: {0}:",{matchedBothCount:t,matchedPwSites:n,novelPasswords:z,matchedPwSitesKeys:_okta(n).keys()});if(!_okta(n).isEmpty()&&z.length==1){m=true;o=true;f=true;r=e(n);if(!r){r=e(u,n)}s=r.username}else{if(_okta(n).isEmpty()&&z.length==1&&h.length==1&&y==2){m=true;o=true;f=true;r=h[0];s=r.username}else{if((t!=0&&t==_okta(n).keys().length)){o=false;j=true}else{if(!g||!k){o=false}else{o=true;r=h.length==1?h[0]:e(u);f=(r&&!_okta(r.password).isEmpty());if(!z.length){z=r?[r.password]:_okta(h).map(function(i){return i.password})}s=g}}}}return{promptSave:o,matchedSites:h,formData:{username:s,passwords:z},matchedSite:r,isChangePassword:f,isFromChangePwForm:m,exactUserPassLogin:j}}this.processFormCapture=function(g,f){var e=a.getFormSites(g);return e.length===0?null:d(f,e)};this.init=function(e){Log.debug("FormProcessor::init");a=e}};