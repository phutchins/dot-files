System.expect("OktaApiClient");System.expect("SiteFlow");System.expect("Log");function OktaScriptEngine(c,b){Log.debug("OktaScriptEngine init started");function d(f){var e=f?f.getState():null;c.setSessionState(OKTA_SESSION_KEYS.CURRENT_FLOW,e)}function a(){var e=c.getSessionState(OKTA_SESSION_KEYS.CURRENT_FLOW,null);if(e==null){return null}var f=new SiteFlow(b);f.load(e);return f}this.forceStartFlow=function(e){Log.debug("OktaScriptEngine::forceStartFlow: Forcing execution of flow {0}",e);var f=new SiteFlow(b);f.init(e);d(f)};this.getScript=function(h,g){Log.debug("OktaScriptEngine::getScript");var f=a();if(f){Log.debug("Looking for next script in current flow");var e=f.nextURL(h,g);if(e==NOT_YET_IN_FLOW){return this.checkForNewFlow(h)}else{if(e==TOP_DOCUMENT_EXPECTED){Log.debug("Site flow does not have a match for "+h.href+"; waiting for the top document");return null}else{if(e==OTHER_FRAME_EXPECTED){Log.debug("Site flow does not have a match for "+h.href+"; waiting for another frame");return null}else{if(!e){Log.debug("Site flow does not have a match for "+h.href+"; bailing out");d(null);return null}else{if(e.lastInFlow){d(null)}else{Log.debug("Saving state of the current flow");d(f)}}}}}return e.script}else{return this.checkForNewFlow(h)}};this.checkForNewFlow=function(g){Log.debug("OktaScriptEngine::checkForNewFlow: {0}",g.href);var e=b.findSite(g);if(e){Log.debug("Found site-flow matching "+g.href);var f=new SiteFlow(b);f.init(e);d(f);return"SITEFLOW_LOADED"}else{Log.debug("Did not find siteflow matching: "+g.href)}return null}};